using System;
using System.Collections.Generic;
using System.Runtime.CompilerServices;
using System.Text;

namespace Alumis.Text.Unicode
{
    public static class Extensions
    {
        [MethodImpl(MethodImplOptions.AggressiveInlining)]
        public static void AppendCodePoint(this StringBuilder stringBuilder, uint cp)
        {
            if (0x10000 <= cp)
            {
                stringBuilder.Append((char)((cp >> 10) + 0xd7c0));
                stringBuilder.Append((char)((cp & 0x3ff) | 0xdc00));
            }

            else stringBuilder.Append((char)cp);
        }

        [MethodImpl(MethodImplOptions.AggressiveInlining)]
        public static byte GetUtf8Lo(this byte b)
        {
            return (byte)(b & ~(128 + 64)); /* 11000000 */
        }

        [MethodImpl(MethodImplOptions.AggressiveInlining)]
        public static bool IsUtf8Lo(this byte b)
        {
            return (b & (128 + 64) /* 11000000 */) == 128; /* 10000000 */
        }

        public static bool IsNewlineGrapheme(this string str)
        {
            switch (str)
            {
                case "\n":
                case "\r\n":
                case "\r":
                case "\x85":
                case "\xb":
                case "\xc":
                case "\x2028":
                case "\x2029":
                    return true;
            }

            return false;
        }

        public static bool IsHexGrapheme(this string str)
        {
            if (str.Length != 1)
                return false;

            var c = str[0];

            return '0' <= c && c <= '9' || 'a' <= c && c <= 'f' || 'A' <= c && c <= 'F';
        }

        public static bool IsDecGrapheme(this string str)
        {
            if (str.Length != 1)
                return false;

            var c = str[0];

            return '0' <= c && c <= '9';
        }

        public static uint LastCodePoint(this string str)
        {
            uint c = str[str.Length - 1];

            if (2 <= str.Length && (c & 0xfffffc00) == 0xdc00)
            {
                uint c2 = str[str.Length - 2];

                if ((c2 & 0xfffffc00) == 0xd800)
                    return (c << 10) + c2 - ((0xd800 << 10) + 0xdc00 - 0x10000);
            }

            return c;
        }

        public static bool IsWhitespaceGrapheme(this string str)
        {
            if (str.Length != 1)
                return false;

            switch (str[0])
            {
                case ' ':
                case '\t':
                case '\n':
                case '\xb':
                case '\xc':
                case '\r':
                case '\x85':
                case '\x200e':
                case '\x200f':
                case '\x2028':
                case '\x2029':
                    return true;
            }

            return false;
        }

        static RedBlackTreeNode<Interval> _xidContinueRanges, _xidStartRanges;

        public static bool HasBinaryPropertyXidContinue(this uint cp)
        {
            if (cp == '_')
                return false;

            var node = _xidContinueRanges;

            for (; ; )
            {
                if (cp < node.Value.Index)
                    node = node.Left;

                else if (node.Value.IndexUpper <= cp)
                    node = node.Right;

                else return true;

                if (node == null)
                    return cp == 0x200c;
            }
        }

        public static bool HasBinaryPropertyXidStart(this uint cp)
        {
            if (cp == '_')
                return false;

            var node = _xidStartRanges;

            for (; ; )
            {
                if (cp < node.Value.Index)
                    node = node.Left;

                else if (node.Value.IndexUpper <= cp)
                    node = node.Right;

                else return true;

                if (node == null)
                    return false;
            }
        }

        static Extensions()
        {
            var ranges = new int[][]
            {
                new [] { 48, 58 },
                new [] { 65, 91 },
                new [] { 95, 96 },
                new [] { 97, 123 },
                new [] { 170, 171 },
                new [] { 181, 182 },
                new [] { 183, 184 },
                new [] { 186, 187 },
                new [] { 192, 215 },
                new [] { 216, 247 },
                new [] { 248, 706 },
                new [] { 710, 722 },
                new [] { 736, 741 },
                new [] { 748, 749 },
                new [] { 750, 751 },
                new [] { 768, 885 },
                new [] { 886, 888 },
                new [] { 891, 894 },
                new [] { 895, 896 },
                new [] { 902, 907 },
                new [] { 908, 909 },
                new [] { 910, 930 },
                new [] { 931, 1014 },
                new [] { 1015, 1154 },
                new [] { 1155, 1160 },
                new [] { 1162, 1328 },
                new [] { 1329, 1367 },
                new [] { 1369, 1370 },
                new [] { 1377, 1416 },
                new [] { 1425, 1470 },
                new [] { 1471, 1472 },
                new [] { 1473, 1475 },
                new [] { 1476, 1478 },
                new [] { 1479, 1480 },
                new [] { 1488, 1515 },
                new [] { 1520, 1523 },
                new [] { 1552, 1563 },
                new [] { 1568, 1642 },
                new [] { 1646, 1748 },
                new [] { 1749, 1757 },
                new [] { 1759, 1769 },
                new [] { 1770, 1789 },
                new [] { 1791, 1792 },
                new [] { 1808, 1867 },
                new [] { 1869, 1970 },
                new [] { 1984, 2038 },
                new [] { 2042, 2043 },
                new [] { 2048, 2094 },
                new [] { 2112, 2140 },
                new [] { 2208, 2227 },
                new [] { 2276, 2404 },
                new [] { 2406, 2416 },
                new [] { 2417, 2436 },
                new [] { 2437, 2445 },
                new [] { 2447, 2449 },
                new [] { 2451, 2473 },
                new [] { 2474, 2481 },
                new [] { 2482, 2483 },
                new [] { 2486, 2490 },
                new [] { 2492, 2501 },
                new [] { 2503, 2505 },
                new [] { 2507, 2511 },
                new [] { 2519, 2520 },
                new [] { 2524, 2526 },
                new [] { 2527, 2532 },
                new [] { 2534, 2546 },
                new [] { 2561, 2564 },
                new [] { 2565, 2571 },
                new [] { 2575, 2577 },
                new [] { 2579, 2601 },
                new [] { 2602, 2609 },
                new [] { 2610, 2612 },
                new [] { 2613, 2615 },
                new [] { 2616, 2618 },
                new [] { 2620, 2621 },
                new [] { 2622, 2627 },
                new [] { 2631, 2633 },
                new [] { 2635, 2638 },
                new [] { 2641, 2642 },
                new [] { 2649, 2653 },
                new [] { 2654, 2655 },
                new [] { 2662, 2678 },
                new [] { 2689, 2692 },
                new [] { 2693, 2702 },
                new [] { 2703, 2706 },
                new [] { 2707, 2729 },
                new [] { 2730, 2737 },
                new [] { 2738, 2740 },
                new [] { 2741, 2746 },
                new [] { 2748, 2758 },
                new [] { 2759, 2762 },
                new [] { 2763, 2766 },
                new [] { 2768, 2769 },
                new [] { 2784, 2788 },
                new [] { 2790, 2800 },
                new [] { 2817, 2820 },
                new [] { 2821, 2829 },
                new [] { 2831, 2833 },
                new [] { 2835, 2857 },
                new [] { 2858, 2865 },
                new [] { 2866, 2868 },
                new [] { 2869, 2874 },
                new [] { 2876, 2885 },
                new [] { 2887, 2889 },
                new [] { 2891, 2894 },
                new [] { 2902, 2904 },
                new [] { 2908, 2910 },
                new [] { 2911, 2916 },
                new [] { 2918, 2928 },
                new [] { 2929, 2930 },
                new [] { 2946, 2948 },
                new [] { 2949, 2955 },
                new [] { 2958, 2961 },
                new [] { 2962, 2966 },
                new [] { 2969, 2971 },
                new [] { 2972, 2973 },
                new [] { 2974, 2976 },
                new [] { 2979, 2981 },
                new [] { 2984, 2987 },
                new [] { 2990, 3002 },
                new [] { 3006, 3011 },
                new [] { 3014, 3017 },
                new [] { 3018, 3022 },
                new [] { 3024, 3025 },
                new [] { 3031, 3032 },
                new [] { 3046, 3056 },
                new [] { 3072, 3076 },
                new [] { 3077, 3085 },
                new [] { 3086, 3089 },
                new [] { 3090, 3113 },
                new [] { 3114, 3130 },
                new [] { 3133, 3141 },
                new [] { 3142, 3145 },
                new [] { 3146, 3150 },
                new [] { 3157, 3159 },
                new [] { 3160, 3162 },
                new [] { 3168, 3172 },
                new [] { 3174, 3184 },
                new [] { 3201, 3204 },
                new [] { 3205, 3213 },
                new [] { 3214, 3217 },
                new [] { 3218, 3241 },
                new [] { 3242, 3252 },
                new [] { 3253, 3258 },
                new [] { 3260, 3269 },
                new [] { 3270, 3273 },
                new [] { 3274, 3278 },
                new [] { 3285, 3287 },
                new [] { 3294, 3295 },
                new [] { 3296, 3300 },
                new [] { 3302, 3312 },
                new [] { 3313, 3315 },
                new [] { 3329, 3332 },
                new [] { 3333, 3341 },
                new [] { 3342, 3345 },
                new [] { 3346, 3387 },
                new [] { 3389, 3397 },
                new [] { 3398, 3401 },
                new [] { 3402, 3407 },
                new [] { 3415, 3416 },
                new [] { 3424, 3428 },
                new [] { 3430, 3440 },
                new [] { 3450, 3456 },
                new [] { 3458, 3460 },
                new [] { 3461, 3479 },
                new [] { 3482, 3506 },
                new [] { 3507, 3516 },
                new [] { 3517, 3518 },
                new [] { 3520, 3527 },
                new [] { 3530, 3531 },
                new [] { 3535, 3541 },
                new [] { 3542, 3543 },
                new [] { 3544, 3552 },
                new [] { 3558, 3568 },
                new [] { 3570, 3572 },
                new [] { 3585, 3643 },
                new [] { 3648, 3663 },
                new [] { 3664, 3674 },
                new [] { 3713, 3715 },
                new [] { 3716, 3717 },
                new [] { 3719, 3721 },
                new [] { 3722, 3723 },
                new [] { 3725, 3726 },
                new [] { 3732, 3736 },
                new [] { 3737, 3744 },
                new [] { 3745, 3748 },
                new [] { 3749, 3750 },
                new [] { 3751, 3752 },
                new [] { 3754, 3756 },
                new [] { 3757, 3770 },
                new [] { 3771, 3774 },
                new [] { 3776, 3781 },
                new [] { 3782, 3783 },
                new [] { 3784, 3790 },
                new [] { 3792, 3802 },
                new [] { 3804, 3808 },
                new [] { 3840, 3841 },
                new [] { 3864, 3866 },
                new [] { 3872, 3882 },
                new [] { 3893, 3894 },
                new [] { 3895, 3896 },
                new [] { 3897, 3898 },
                new [] { 3902, 3912 },
                new [] { 3913, 3949 },
                new [] { 3953, 3973 },
                new [] { 3974, 3992 },
                new [] { 3993, 4029 },
                new [] { 4038, 4039 },
                new [] { 4096, 4170 },
                new [] { 4176, 4254 },
                new [] { 4256, 4294 },
                new [] { 4295, 4296 },
                new [] { 4301, 4302 },
                new [] { 4304, 4347 },
                new [] { 4348, 4681 },
                new [] { 4682, 4686 },
                new [] { 4688, 4695 },
                new [] { 4696, 4697 },
                new [] { 4698, 4702 },
                new [] { 4704, 4745 },
                new [] { 4746, 4750 },
                new [] { 4752, 4785 },
                new [] { 4786, 4790 },
                new [] { 4792, 4799 },
                new [] { 4800, 4801 },
                new [] { 4802, 4806 },
                new [] { 4808, 4823 },
                new [] { 4824, 4881 },
                new [] { 4882, 4886 },
                new [] { 4888, 4955 },
                new [] { 4957, 4960 },
                new [] { 4969, 4978 },
                new [] { 4992, 5008 },
                new [] { 5024, 5109 },
                new [] { 5121, 5741 },
                new [] { 5743, 5760 },
                new [] { 5761, 5787 },
                new [] { 5792, 5867 },
                new [] { 5870, 5881 },
                new [] { 5888, 5901 },
                new [] { 5902, 5909 },
                new [] { 5920, 5941 },
                new [] { 5952, 5972 },
                new [] { 5984, 5997 },
                new [] { 5998, 6001 },
                new [] { 6002, 6004 },
                new [] { 6016, 6100 },
                new [] { 6103, 6104 },
                new [] { 6108, 6110 },
                new [] { 6112, 6122 },
                new [] { 6155, 6158 },
                new [] { 6160, 6170 },
                new [] { 6176, 6264 },
                new [] { 6272, 6315 },
                new [] { 6320, 6390 },
                new [] { 6400, 6431 },
                new [] { 6432, 6444 },
                new [] { 6448, 6460 },
                new [] { 6470, 6510 },
                new [] { 6512, 6517 },
                new [] { 6528, 6572 },
                new [] { 6576, 6602 },
                new [] { 6608, 6619 },
                new [] { 6656, 6684 },
                new [] { 6688, 6751 },
                new [] { 6752, 6781 },
                new [] { 6783, 6794 },
                new [] { 6800, 6810 },
                new [] { 6823, 6824 },
                new [] { 6832, 6846 },
                new [] { 6912, 6988 },
                new [] { 6992, 7002 },
                new [] { 7019, 7028 },
                new [] { 7040, 7156 },
                new [] { 7168, 7224 },
                new [] { 7232, 7242 },
                new [] { 7245, 7294 },
                new [] { 7376, 7379 },
                new [] { 7380, 7415 },
                new [] { 7416, 7418 },
                new [] { 7424, 7670 },
                new [] { 7676, 7958 },
                new [] { 7960, 7966 },
                new [] { 7968, 8006 },
                new [] { 8008, 8014 },
                new [] { 8016, 8024 },
                new [] { 8025, 8026 },
                new [] { 8027, 8028 },
                new [] { 8029, 8030 },
                new [] { 8031, 8062 },
                new [] { 8064, 8117 },
                new [] { 8118, 8125 },
                new [] { 8126, 8127 },
                new [] { 8130, 8133 },
                new [] { 8134, 8141 },
                new [] { 8144, 8148 },
                new [] { 8150, 8156 },
                new [] { 8160, 8173 },
                new [] { 8178, 8181 },
                new [] { 8182, 8189 },
                new [] { 8255, 8257 },
                new [] { 8276, 8277 },
                new [] { 8305, 8306 },
                new [] { 8319, 8320 },
                new [] { 8336, 8349 },
                new [] { 8400, 8413 },
                new [] { 8417, 8418 },
                new [] { 8421, 8433 },
                new [] { 8450, 8451 },
                new [] { 8455, 8456 },
                new [] { 8458, 8468 },
                new [] { 8469, 8470 },
                new [] { 8472, 8478 },
                new [] { 8484, 8485 },
                new [] { 8486, 8487 },
                new [] { 8488, 8489 },
                new [] { 8490, 8506 },
                new [] { 8508, 8512 },
                new [] { 8517, 8522 },
                new [] { 8526, 8527 },
                new [] { 8544, 8585 },
                new [] { 11264, 11311 },
                new [] { 11312, 11359 },
                new [] { 11360, 11493 },
                new [] { 11499, 11508 },
                new [] { 11520, 11558 },
                new [] { 11559, 11560 },
                new [] { 11565, 11566 },
                new [] { 11568, 11624 },
                new [] { 11631, 11632 },
                new [] { 11647, 11671 },
                new [] { 11680, 11687 },
                new [] { 11688, 11695 },
                new [] { 11696, 11703 },
                new [] { 11704, 11711 },
                new [] { 11712, 11719 },
                new [] { 11720, 11727 },
                new [] { 11728, 11735 },
                new [] { 11736, 11743 },
                new [] { 11744, 11776 },
                new [] { 12293, 12296 },
                new [] { 12321, 12336 },
                new [] { 12337, 12342 },
                new [] { 12344, 12349 },
                new [] { 12353, 12439 },
                new [] { 12441, 12443 },
                new [] { 12445, 12448 },
                new [] { 12449, 12539 },
                new [] { 12540, 12544 },
                new [] { 12549, 12590 },
                new [] { 12593, 12687 },
                new [] { 12704, 12731 },
                new [] { 12784, 12800 },
                new [] { 13312, 19894 },
                new [] { 19968, 40909 },
                new [] { 40960, 42125 },
                new [] { 42192, 42238 },
                new [] { 42240, 42509 },
                new [] { 42512, 42540 },
                new [] { 42560, 42608 },
                new [] { 42612, 42622 },
                new [] { 42623, 42654 },
                new [] { 42655, 42738 },
                new [] { 42775, 42784 },
                new [] { 42786, 42889 },
                new [] { 42891, 42895 },
                new [] { 42896, 42926 },
                new [] { 42928, 42930 },
                new [] { 42999, 43048 },
                new [] { 43072, 43124 },
                new [] { 43136, 43205 },
                new [] { 43216, 43226 },
                new [] { 43232, 43256 },
                new [] { 43259, 43260 },
                new [] { 43264, 43310 },
                new [] { 43312, 43348 },
                new [] { 43360, 43389 },
                new [] { 43392, 43457 },
                new [] { 43471, 43482 },
                new [] { 43488, 43519 },
                new [] { 43520, 43575 },
                new [] { 43584, 43598 },
                new [] { 43600, 43610 },
                new [] { 43616, 43639 },
                new [] { 43642, 43715 },
                new [] { 43739, 43742 },
                new [] { 43744, 43760 },
                new [] { 43762, 43767 },
                new [] { 43777, 43783 },
                new [] { 43785, 43791 },
                new [] { 43793, 43799 },
                new [] { 43808, 43815 },
                new [] { 43816, 43823 },
                new [] { 43824, 43867 },
                new [] { 43868, 43872 },
                new [] { 43876, 43878 },
                new [] { 43968, 44011 },
                new [] { 44012, 44014 },
                new [] { 44016, 44026 },
                new [] { 44032, 55204 },
                new [] { 55216, 55239 },
                new [] { 55243, 55292 },
                new [] { 63744, 64110 },
                new [] { 64112, 64218 },
                new [] { 64256, 64263 },
                new [] { 64275, 64280 },
                new [] { 64285, 64297 },
                new [] { 64298, 64311 },
                new [] { 64312, 64317 },
                new [] { 64318, 64319 },
                new [] { 64320, 64322 },
                new [] { 64323, 64325 },
                new [] { 64326, 64434 },
                new [] { 64467, 64606 },
                new [] { 64612, 64830 },
                new [] { 64848, 64912 },
                new [] { 64914, 64968 },
                new [] { 65008, 65018 },
                new [] { 65024, 65040 },
                new [] { 65056, 65070 },
                new [] { 65075, 65077 },
                new [] { 65101, 65104 },
                new [] { 65137, 65138 },
                new [] { 65139, 65140 },
                new [] { 65143, 65144 },
                new [] { 65145, 65146 },
                new [] { 65147, 65148 },
                new [] { 65149, 65150 },
                new [] { 65151, 65277 },
                new [] { 65296, 65306 },
                new [] { 65313, 65339 },
                new [] { 65343, 65344 },
                new [] { 65345, 65371 },
                new [] { 65382, 65471 },
                new [] { 65474, 65480 },
                new [] { 65482, 65488 },
                new [] { 65490, 65496 },
                new [] { 65498, 65501 },
                new [] { 65536, 65548 },
                new [] { 65549, 65575 },
                new [] { 65576, 65595 },
                new [] { 65596, 65598 },
                new [] { 65599, 65614 },
                new [] { 65616, 65630 },
                new [] { 65664, 65787 },
                new [] { 65856, 65909 },
                new [] { 66045, 66046 },
                new [] { 66176, 66205 },
                new [] { 66208, 66257 },
                new [] { 66272, 66273 },
                new [] { 66304, 66336 },
                new [] { 66352, 66379 },
                new [] { 66384, 66427 },
                new [] { 66432, 66462 },
                new [] { 66464, 66500 },
                new [] { 66504, 66512 },
                new [] { 66513, 66518 },
                new [] { 66560, 66718 },
                new [] { 66720, 66730 },
                new [] { 66816, 66856 },
                new [] { 66864, 66916 },
                new [] { 67072, 67383 },
                new [] { 67392, 67414 },
                new [] { 67424, 67432 },
                new [] { 67584, 67590 },
                new [] { 67592, 67593 },
                new [] { 67594, 67638 },
                new [] { 67639, 67641 },
                new [] { 67644, 67645 },
                new [] { 67647, 67670 },
                new [] { 67680, 67703 },
                new [] { 67712, 67743 },
                new [] { 67840, 67862 },
                new [] { 67872, 67898 },
                new [] { 67968, 68024 },
                new [] { 68030, 68032 },
                new [] { 68096, 68100 },
                new [] { 68101, 68103 },
                new [] { 68108, 68116 },
                new [] { 68117, 68120 },
                new [] { 68121, 68148 },
                new [] { 68152, 68155 },
                new [] { 68159, 68160 },
                new [] { 68192, 68221 },
                new [] { 68224, 68253 },
                new [] { 68288, 68296 },
                new [] { 68297, 68327 },
                new [] { 68352, 68406 },
                new [] { 68416, 68438 },
                new [] { 68448, 68467 },
                new [] { 68480, 68498 },
                new [] { 68608, 68681 },
                new [] { 69632, 69703 },
                new [] { 69734, 69744 },
                new [] { 69759, 69819 },
                new [] { 69840, 69865 },
                new [] { 69872, 69882 },
                new [] { 69888, 69941 },
                new [] { 69942, 69952 },
                new [] { 69968, 70004 },
                new [] { 70006, 70007 },
                new [] { 70016, 70085 },
                new [] { 70096, 70107 },
                new [] { 70144, 70162 },
                new [] { 70163, 70200 },
                new [] { 70320, 70379 },
                new [] { 70384, 70394 },
                new [] { 70401, 70404 },
                new [] { 70405, 70413 },
                new [] { 70415, 70417 },
                new [] { 70419, 70441 },
                new [] { 70442, 70449 },
                new [] { 70450, 70452 },
                new [] { 70453, 70458 },
                new [] { 70460, 70469 },
                new [] { 70471, 70473 },
                new [] { 70475, 70478 },
                new [] { 70487, 70488 },
                new [] { 70493, 70500 },
                new [] { 70502, 70509 },
                new [] { 70512, 70517 },
                new [] { 70784, 70854 },
                new [] { 70855, 70856 },
                new [] { 70864, 70874 },
                new [] { 71040, 71094 },
                new [] { 71096, 71105 },
                new [] { 71168, 71233 },
                new [] { 71236, 71237 },
                new [] { 71248, 71258 },
                new [] { 71296, 71352 },
                new [] { 71360, 71370 },
                new [] { 71840, 71914 },
                new [] { 71935, 71936 },
                new [] { 72384, 72441 },
                new [] { 73728, 74649 },
                new [] { 74752, 74863 },
                new [] { 77824, 78895 },
                new [] { 92160, 92729 },
                new [] { 92736, 92767 },
                new [] { 92768, 92778 },
                new [] { 92880, 92910 },
                new [] { 92912, 92917 },
                new [] { 92928, 92983 },
                new [] { 92992, 92996 },
                new [] { 93008, 93018 },
                new [] { 93027, 93048 },
                new [] { 93053, 93072 },
                new [] { 93952, 94021 },
                new [] { 94032, 94079 },
                new [] { 94095, 94112 },
                new [] { 110592, 110594 },
                new [] { 113664, 113771 },
                new [] { 113776, 113789 },
                new [] { 113792, 113801 },
                new [] { 113808, 113818 },
                new [] { 113821, 113823 },
                new [] { 119141, 119146 },
                new [] { 119149, 119155 },
                new [] { 119163, 119171 },
                new [] { 119173, 119180 },
                new [] { 119210, 119214 },
                new [] { 119362, 119365 },
                new [] { 119808, 119893 },
                new [] { 119894, 119965 },
                new [] { 119966, 119968 },
                new [] { 119970, 119971 },
                new [] { 119973, 119975 },
                new [] { 119977, 119981 },
                new [] { 119982, 119994 },
                new [] { 119995, 119996 },
                new [] { 119997, 120004 },
                new [] { 120005, 120070 },
                new [] { 120071, 120075 },
                new [] { 120077, 120085 },
                new [] { 120086, 120093 },
                new [] { 120094, 120122 },
                new [] { 120123, 120127 },
                new [] { 120128, 120133 },
                new [] { 120134, 120135 },
                new [] { 120138, 120145 },
                new [] { 120146, 120486 },
                new [] { 120488, 120513 },
                new [] { 120514, 120539 },
                new [] { 120540, 120571 },
                new [] { 120572, 120597 },
                new [] { 120598, 120629 },
                new [] { 120630, 120655 },
                new [] { 120656, 120687 },
                new [] { 120688, 120713 },
                new [] { 120714, 120745 },
                new [] { 120746, 120771 },
                new [] { 120772, 120780 },
                new [] { 120782, 120832 },
                new [] { 124928, 125125 },
                new [] { 125136, 125143 },
                new [] { 126464, 126468 },
                new [] { 126469, 126496 },
                new [] { 126497, 126499 },
                new [] { 126500, 126501 },
                new [] { 126503, 126504 },
                new [] { 126505, 126515 },
                new [] { 126516, 126520 },
                new [] { 126521, 126522 },
                new [] { 126523, 126524 },
                new [] { 126530, 126531 },
                new [] { 126535, 126536 },
                new [] { 126537, 126538 },
                new [] { 126539, 126540 },
                new [] { 126541, 126544 },
                new [] { 126545, 126547 },
                new [] { 126548, 126549 },
                new [] { 126551, 126552 },
                new [] { 126553, 126554 },
                new [] { 126555, 126556 },
                new [] { 126557, 126558 },
                new [] { 126559, 126560 },
                new [] { 126561, 126563 },
                new [] { 126564, 126565 },
                new [] { 126567, 126571 },
                new [] { 126572, 126579 },
                new [] { 126580, 126584 },
                new [] { 126585, 126589 },
                new [] { 126590, 126591 },
                new [] { 126592, 126602 },
                new [] { 126603, 126620 },
                new [] { 126625, 126628 },
                new [] { 126629, 126634 },
                new [] { 126635, 126652 },
                new [] { 131072, 173783 },
                new [] { 173824, 177973 },
                new [] { 177984, 178206 },
                new [] { 194560, 195102 },
                new [] { 917760, 918000 }
            };

            for (var i = 0; i < ranges.Length; ++i)
            {
                var range = ranges[i];

                var node = new RedBlackTreeNode<Interval>() { Value = new Interval(range[0], range[1]) };

                RedBlackTree.InsertRight(node, ref _xidContinueRanges);
                RedBlackTree.Balance(node, ref _xidContinueRanges);
            }

            ranges = new int[][]
            {
                new [] { 65, 91 },
                new [] { 97, 123 },
                new [] { 170, 171 },
                new [] { 181, 182 },
                new [] { 186, 187 },
                new [] { 192, 215 },
                new [] { 216, 247 },
                new [] { 248, 706 },
                new [] { 710, 722 },
                new [] { 736, 741 },
                new [] { 748, 749 },
                new [] { 750, 751 },
                new [] { 880, 885 },
                new [] { 886, 888 },
                new [] { 891, 894 },
                new [] { 895, 896 },
                new [] { 902, 903 },
                new [] { 904, 907 },
                new [] { 908, 909 },
                new [] { 910, 930 },
                new [] { 931, 1014 },
                new [] { 1015, 1154 },
                new [] { 1162, 1328 },
                new [] { 1329, 1367 },
                new [] { 1369, 1370 },
                new [] { 1377, 1416 },
                new [] { 1488, 1515 },
                new [] { 1520, 1523 },
                new [] { 1568, 1611 },
                new [] { 1646, 1648 },
                new [] { 1649, 1748 },
                new [] { 1749, 1750 },
                new [] { 1765, 1767 },
                new [] { 1774, 1776 },
                new [] { 1786, 1789 },
                new [] { 1791, 1792 },
                new [] { 1808, 1809 },
                new [] { 1810, 1840 },
                new [] { 1869, 1958 },
                new [] { 1969, 1970 },
                new [] { 1994, 2027 },
                new [] { 2036, 2038 },
                new [] { 2042, 2043 },
                new [] { 2048, 2070 },
                new [] { 2074, 2075 },
                new [] { 2084, 2085 },
                new [] { 2088, 2089 },
                new [] { 2112, 2137 },
                new [] { 2208, 2227 },
                new [] { 2308, 2362 },
                new [] { 2365, 2366 },
                new [] { 2384, 2385 },
                new [] { 2392, 2402 },
                new [] { 2417, 2433 },
                new [] { 2437, 2445 },
                new [] { 2447, 2449 },
                new [] { 2451, 2473 },
                new [] { 2474, 2481 },
                new [] { 2482, 2483 },
                new [] { 2486, 2490 },
                new [] { 2493, 2494 },
                new [] { 2510, 2511 },
                new [] { 2524, 2526 },
                new [] { 2527, 2530 },
                new [] { 2544, 2546 },
                new [] { 2565, 2571 },
                new [] { 2575, 2577 },
                new [] { 2579, 2601 },
                new [] { 2602, 2609 },
                new [] { 2610, 2612 },
                new [] { 2613, 2615 },
                new [] { 2616, 2618 },
                new [] { 2649, 2653 },
                new [] { 2654, 2655 },
                new [] { 2674, 2677 },
                new [] { 2693, 2702 },
                new [] { 2703, 2706 },
                new [] { 2707, 2729 },
                new [] { 2730, 2737 },
                new [] { 2738, 2740 },
                new [] { 2741, 2746 },
                new [] { 2749, 2750 },
                new [] { 2768, 2769 },
                new [] { 2784, 2786 },
                new [] { 2821, 2829 },
                new [] { 2831, 2833 },
                new [] { 2835, 2857 },
                new [] { 2858, 2865 },
                new [] { 2866, 2868 },
                new [] { 2869, 2874 },
                new [] { 2877, 2878 },
                new [] { 2908, 2910 },
                new [] { 2911, 2914 },
                new [] { 2929, 2930 },
                new [] { 2947, 2948 },
                new [] { 2949, 2955 },
                new [] { 2958, 2961 },
                new [] { 2962, 2966 },
                new [] { 2969, 2971 },
                new [] { 2972, 2973 },
                new [] { 2974, 2976 },
                new [] { 2979, 2981 },
                new [] { 2984, 2987 },
                new [] { 2990, 3002 },
                new [] { 3024, 3025 },
                new [] { 3077, 3085 },
                new [] { 3086, 3089 },
                new [] { 3090, 3113 },
                new [] { 3114, 3130 },
                new [] { 3133, 3134 },
                new [] { 3160, 3162 },
                new [] { 3168, 3170 },
                new [] { 3205, 3213 },
                new [] { 3214, 3217 },
                new [] { 3218, 3241 },
                new [] { 3242, 3252 },
                new [] { 3253, 3258 },
                new [] { 3261, 3262 },
                new [] { 3294, 3295 },
                new [] { 3296, 3298 },
                new [] { 3313, 3315 },
                new [] { 3333, 3341 },
                new [] { 3342, 3345 },
                new [] { 3346, 3387 },
                new [] { 3389, 3390 },
                new [] { 3406, 3407 },
                new [] { 3424, 3426 },
                new [] { 3450, 3456 },
                new [] { 3461, 3479 },
                new [] { 3482, 3506 },
                new [] { 3507, 3516 },
                new [] { 3517, 3518 },
                new [] { 3520, 3527 },
                new [] { 3585, 3633 },
                new [] { 3634, 3635 },
                new [] { 3648, 3655 },
                new [] { 3713, 3715 },
                new [] { 3716, 3717 },
                new [] { 3719, 3721 },
                new [] { 3722, 3723 },
                new [] { 3725, 3726 },
                new [] { 3732, 3736 },
                new [] { 3737, 3744 },
                new [] { 3745, 3748 },
                new [] { 3749, 3750 },
                new [] { 3751, 3752 },
                new [] { 3754, 3756 },
                new [] { 3757, 3761 },
                new [] { 3762, 3763 },
                new [] { 3773, 3774 },
                new [] { 3776, 3781 },
                new [] { 3782, 3783 },
                new [] { 3804, 3808 },
                new [] { 3840, 3841 },
                new [] { 3904, 3912 },
                new [] { 3913, 3949 },
                new [] { 3976, 3981 },
                new [] { 4096, 4139 },
                new [] { 4159, 4160 },
                new [] { 4176, 4182 },
                new [] { 4186, 4190 },
                new [] { 4193, 4194 },
                new [] { 4197, 4199 },
                new [] { 4206, 4209 },
                new [] { 4213, 4226 },
                new [] { 4238, 4239 },
                new [] { 4256, 4294 },
                new [] { 4295, 4296 },
                new [] { 4301, 4302 },
                new [] { 4304, 4347 },
                new [] { 4348, 4681 },
                new [] { 4682, 4686 },
                new [] { 4688, 4695 },
                new [] { 4696, 4697 },
                new [] { 4698, 4702 },
                new [] { 4704, 4745 },
                new [] { 4746, 4750 },
                new [] { 4752, 4785 },
                new [] { 4786, 4790 },
                new [] { 4792, 4799 },
                new [] { 4800, 4801 },
                new [] { 4802, 4806 },
                new [] { 4808, 4823 },
                new [] { 4824, 4881 },
                new [] { 4882, 4886 },
                new [] { 4888, 4955 },
                new [] { 4992, 5008 },
                new [] { 5024, 5109 },
                new [] { 5121, 5741 },
                new [] { 5743, 5760 },
                new [] { 5761, 5787 },
                new [] { 5792, 5867 },
                new [] { 5870, 5881 },
                new [] { 5888, 5901 },
                new [] { 5902, 5906 },
                new [] { 5920, 5938 },
                new [] { 5952, 5970 },
                new [] { 5984, 5997 },
                new [] { 5998, 6001 },
                new [] { 6016, 6068 },
                new [] { 6103, 6104 },
                new [] { 6108, 6109 },
                new [] { 6176, 6264 },
                new [] { 6272, 6313 },
                new [] { 6314, 6315 },
                new [] { 6320, 6390 },
                new [] { 6400, 6431 },
                new [] { 6480, 6510 },
                new [] { 6512, 6517 },
                new [] { 6528, 6572 },
                new [] { 6593, 6600 },
                new [] { 6656, 6679 },
                new [] { 6688, 6741 },
                new [] { 6823, 6824 },
                new [] { 6917, 6964 },
                new [] { 6981, 6988 },
                new [] { 7043, 7073 },
                new [] { 7086, 7088 },
                new [] { 7098, 7142 },
                new [] { 7168, 7204 },
                new [] { 7245, 7248 },
                new [] { 7258, 7294 },
                new [] { 7401, 7405 },
                new [] { 7406, 7410 },
                new [] { 7413, 7415 },
                new [] { 7424, 7616 },
                new [] { 7680, 7958 },
                new [] { 7960, 7966 },
                new [] { 7968, 8006 },
                new [] { 8008, 8014 },
                new [] { 8016, 8024 },
                new [] { 8025, 8026 },
                new [] { 8027, 8028 },
                new [] { 8029, 8030 },
                new [] { 8031, 8062 },
                new [] { 8064, 8117 },
                new [] { 8118, 8125 },
                new [] { 8126, 8127 },
                new [] { 8130, 8133 },
                new [] { 8134, 8141 },
                new [] { 8144, 8148 },
                new [] { 8150, 8156 },
                new [] { 8160, 8173 },
                new [] { 8178, 8181 },
                new [] { 8182, 8189 },
                new [] { 8305, 8306 },
                new [] { 8319, 8320 },
                new [] { 8336, 8349 },
                new [] { 8450, 8451 },
                new [] { 8455, 8456 },
                new [] { 8458, 8468 },
                new [] { 8469, 8470 },
                new [] { 8472, 8478 },
                new [] { 8484, 8485 },
                new [] { 8486, 8487 },
                new [] { 8488, 8489 },
                new [] { 8490, 8506 },
                new [] { 8508, 8512 },
                new [] { 8517, 8522 },
                new [] { 8526, 8527 },
                new [] { 8544, 8585 },
                new [] { 11264, 11311 },
                new [] { 11312, 11359 },
                new [] { 11360, 11493 },
                new [] { 11499, 11503 },
                new [] { 11506, 11508 },
                new [] { 11520, 11558 },
                new [] { 11559, 11560 },
                new [] { 11565, 11566 },
                new [] { 11568, 11624 },
                new [] { 11631, 11632 },
                new [] { 11648, 11671 },
                new [] { 11680, 11687 },
                new [] { 11688, 11695 },
                new [] { 11696, 11703 },
                new [] { 11704, 11711 },
                new [] { 11712, 11719 },
                new [] { 11720, 11727 },
                new [] { 11728, 11735 },
                new [] { 11736, 11743 },
                new [] { 12293, 12296 },
                new [] { 12321, 12330 },
                new [] { 12337, 12342 },
                new [] { 12344, 12349 },
                new [] { 12353, 12439 },
                new [] { 12445, 12448 },
                new [] { 12449, 12539 },
                new [] { 12540, 12544 },
                new [] { 12549, 12590 },
                new [] { 12593, 12687 },
                new [] { 12704, 12731 },
                new [] { 12784, 12800 },
                new [] { 13312, 19894 },
                new [] { 19968, 40909 },
                new [] { 40960, 42125 },
                new [] { 42192, 42238 },
                new [] { 42240, 42509 },
                new [] { 42512, 42528 },
                new [] { 42538, 42540 },
                new [] { 42560, 42607 },
                new [] { 42623, 42654 },
                new [] { 42656, 42736 },
                new [] { 42775, 42784 },
                new [] { 42786, 42889 },
                new [] { 42891, 42895 },
                new [] { 42896, 42926 },
                new [] { 42928, 42930 },
                new [] { 42999, 43010 },
                new [] { 43011, 43014 },
                new [] { 43015, 43019 },
                new [] { 43020, 43043 },
                new [] { 43072, 43124 },
                new [] { 43138, 43188 },
                new [] { 43250, 43256 },
                new [] { 43259, 43260 },
                new [] { 43274, 43302 },
                new [] { 43312, 43335 },
                new [] { 43360, 43389 },
                new [] { 43396, 43443 },
                new [] { 43471, 43472 },
                new [] { 43488, 43493 },
                new [] { 43494, 43504 },
                new [] { 43514, 43519 },
                new [] { 43520, 43561 },
                new [] { 43584, 43587 },
                new [] { 43588, 43596 },
                new [] { 43616, 43639 },
                new [] { 43642, 43643 },
                new [] { 43646, 43696 },
                new [] { 43697, 43698 },
                new [] { 43701, 43703 },
                new [] { 43705, 43710 },
                new [] { 43712, 43713 },
                new [] { 43714, 43715 },
                new [] { 43739, 43742 },
                new [] { 43744, 43755 },
                new [] { 43762, 43765 },
                new [] { 43777, 43783 },
                new [] { 43785, 43791 },
                new [] { 43793, 43799 },
                new [] { 43808, 43815 },
                new [] { 43816, 43823 },
                new [] { 43824, 43867 },
                new [] { 43868, 43872 },
                new [] { 43876, 43878 },
                new [] { 43968, 44003 },
                new [] { 44032, 55204 },
                new [] { 55216, 55239 },
                new [] { 55243, 55292 },
                new [] { 63744, 64110 },
                new [] { 64112, 64218 },
                new [] { 64256, 64263 },
                new [] { 64275, 64280 },
                new [] { 64285, 64286 },
                new [] { 64287, 64297 },
                new [] { 64298, 64311 },
                new [] { 64312, 64317 },
                new [] { 64318, 64319 },
                new [] { 64320, 64322 },
                new [] { 64323, 64325 },
                new [] { 64326, 64434 },
                new [] { 64467, 64606 },
                new [] { 64612, 64830 },
                new [] { 64848, 64912 },
                new [] { 64914, 64968 },
                new [] { 65008, 65018 },
                new [] { 65137, 65138 },
                new [] { 65139, 65140 },
                new [] { 65143, 65144 },
                new [] { 65145, 65146 },
                new [] { 65147, 65148 },
                new [] { 65149, 65150 },
                new [] { 65151, 65277 },
                new [] { 65313, 65339 },
                new [] { 65345, 65371 },
                new [] { 65382, 65438 },
                new [] { 65440, 65471 },
                new [] { 65474, 65480 },
                new [] { 65482, 65488 },
                new [] { 65490, 65496 },
                new [] { 65498, 65501 },
                new [] { 65536, 65548 },
                new [] { 65549, 65575 },
                new [] { 65576, 65595 },
                new [] { 65596, 65598 },
                new [] { 65599, 65614 },
                new [] { 65616, 65630 },
                new [] { 65664, 65787 },
                new [] { 65856, 65909 },
                new [] { 66176, 66205 },
                new [] { 66208, 66257 },
                new [] { 66304, 66336 },
                new [] { 66352, 66379 },
                new [] { 66384, 66422 },
                new [] { 66432, 66462 },
                new [] { 66464, 66500 },
                new [] { 66504, 66512 },
                new [] { 66513, 66518 },
                new [] { 66560, 66718 },
                new [] { 66816, 66856 },
                new [] { 66864, 66916 },
                new [] { 67072, 67383 },
                new [] { 67392, 67414 },
                new [] { 67424, 67432 },
                new [] { 67584, 67590 },
                new [] { 67592, 67593 },
                new [] { 67594, 67638 },
                new [] { 67639, 67641 },
                new [] { 67644, 67645 },
                new [] { 67647, 67670 },
                new [] { 67680, 67703 },
                new [] { 67712, 67743 },
                new [] { 67840, 67862 },
                new [] { 67872, 67898 },
                new [] { 67968, 68024 },
                new [] { 68030, 68032 },
                new [] { 68096, 68097 },
                new [] { 68112, 68116 },
                new [] { 68117, 68120 },
                new [] { 68121, 68148 },
                new [] { 68192, 68221 },
                new [] { 68224, 68253 },
                new [] { 68288, 68296 },
                new [] { 68297, 68325 },
                new [] { 68352, 68406 },
                new [] { 68416, 68438 },
                new [] { 68448, 68467 },
                new [] { 68480, 68498 },
                new [] { 68608, 68681 },
                new [] { 69635, 69688 },
                new [] { 69763, 69808 },
                new [] { 69840, 69865 },
                new [] { 69891, 69927 },
                new [] { 69968, 70003 },
                new [] { 70006, 70007 },
                new [] { 70019, 70067 },
                new [] { 70081, 70085 },
                new [] { 70106, 70107 },
                new [] { 70144, 70162 },
                new [] { 70163, 70188 },
                new [] { 70320, 70367 },
                new [] { 70405, 70413 },
                new [] { 70415, 70417 },
                new [] { 70419, 70441 },
                new [] { 70442, 70449 },
                new [] { 70450, 70452 },
                new [] { 70453, 70458 },
                new [] { 70461, 70462 },
                new [] { 70493, 70498 },
                new [] { 70784, 70832 },
                new [] { 70852, 70854 },
                new [] { 70855, 70856 },
                new [] { 71040, 71087 },
                new [] { 71168, 71216 },
                new [] { 71236, 71237 },
                new [] { 71296, 71339 },
                new [] { 71840, 71904 },
                new [] { 71935, 71936 },
                new [] { 72384, 72441 },
                new [] { 73728, 74649 },
                new [] { 74752, 74863 },
                new [] { 77824, 78895 },
                new [] { 92160, 92729 },
                new [] { 92736, 92767 },
                new [] { 92880, 92910 },
                new [] { 92928, 92976 },
                new [] { 92992, 92996 },
                new [] { 93027, 93048 },
                new [] { 93053, 93072 },
                new [] { 93952, 94021 },
                new [] { 94032, 94033 },
                new [] { 94099, 94112 },
                new [] { 110592, 110594 },
                new [] { 113664, 113771 },
                new [] { 113776, 113789 },
                new [] { 113792, 113801 },
                new [] { 113808, 113818 },
                new [] { 119808, 119893 },
                new [] { 119894, 119965 },
                new [] { 119966, 119968 },
                new [] { 119970, 119971 },
                new [] { 119973, 119975 },
                new [] { 119977, 119981 },
                new [] { 119982, 119994 },
                new [] { 119995, 119996 },
                new [] { 119997, 120004 },
                new [] { 120005, 120070 },
                new [] { 120071, 120075 },
                new [] { 120077, 120085 },
                new [] { 120086, 120093 },
                new [] { 120094, 120122 },
                new [] { 120123, 120127 },
                new [] { 120128, 120133 },
                new [] { 120134, 120135 },
                new [] { 120138, 120145 },
                new [] { 120146, 120486 },
                new [] { 120488, 120513 },
                new [] { 120514, 120539 },
                new [] { 120540, 120571 },
                new [] { 120572, 120597 },
                new [] { 120598, 120629 },
                new [] { 120630, 120655 },
                new [] { 120656, 120687 },
                new [] { 120688, 120713 },
                new [] { 120714, 120745 },
                new [] { 120746, 120771 },
                new [] { 120772, 120780 },
                new [] { 124928, 125125 },
                new [] { 126464, 126468 },
                new [] { 126469, 126496 },
                new [] { 126497, 126499 },
                new [] { 126500, 126501 },
                new [] { 126503, 126504 },
                new [] { 126505, 126515 },
                new [] { 126516, 126520 },
                new [] { 126521, 126522 },
                new [] { 126523, 126524 },
                new [] { 126530, 126531 },
                new [] { 126535, 126536 },
                new [] { 126537, 126538 },
                new [] { 126539, 126540 },
                new [] { 126541, 126544 },
                new [] { 126545, 126547 },
                new [] { 126548, 126549 },
                new [] { 126551, 126552 },
                new [] { 126553, 126554 },
                new [] { 126555, 126556 },
                new [] { 126557, 126558 },
                new [] { 126559, 126560 },
                new [] { 126561, 126563 },
                new [] { 126564, 126565 },
                new [] { 126567, 126571 },
                new [] { 126572, 126579 },
                new [] { 126580, 126584 },
                new [] { 126585, 126589 },
                new [] { 126590, 126591 },
                new [] { 126592, 126602 },
                new [] { 126603, 126620 },
                new [] { 126625, 126628 },
                new [] { 126629, 126634 },
                new [] { 126635, 126652 },
                new [] { 131072, 173783 },
                new [] { 173824, 177973 },
                new [] { 177984, 178206 },
                new [] { 194560, 195102 }
            };

            for (var i = 0; i < ranges.Length; ++i)
            {
                var range = ranges[i];

                var node = new RedBlackTreeNode<Interval>() { Value = new Interval(range[0], range[1]) };

                RedBlackTree.InsertRight(node, ref _xidStartRanges);
                RedBlackTree.Balance(node, ref _xidStartRanges);
            }

            ranges = null;
        }
    }
}
